[include fluidd.cfg]
[virtual_sdcard]
path: /home/biqu/printer_data/gcodes
on_error_gcode: PRINT_CANCEL

[include mainsail.cfg]
[include ebb36.cfg]
[include fanControl.cfg]
[include macros.cfg]
[include neopixel_leds.cfg]
[include eddy.cfg]
[include Orbiter2_SmartSensor.cfg]

# This file contains common pin mappings for the BIGTREETECH Manta M8P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" and USB communication.

# See docs/Config_Reference.md for a description of parameters.

[mcu]
##	[X in MOTOR0] - B Motor
##	[Y in MOTOR1] - A Motor
##	[E in MOTOR6] - Extruder
##	Obtain definition by "ls -l /dev/serial/by-id/" then unplug to verify
##--------------------------------------------------------------------
# serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_270027000A504B4633373520-if00
canbus_uuid: 2d78c06320c4
#restart_method: command
##--------------------------------------------------------------------

# [mcu eddy]
# serial: /dev/serial/by-id/usb-Klipper_rp2040_5044340310BA771C-if00

[exclude_object]

[skew_correction]


[printer]
kinematics: corexy
max_velocity: 10000  
max_accel: 6000    			#Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 5.0


# [temperature_sensor MCU]
# sensor_type: temperature_mcu
# min_temp: 0
# max_temp: 100

# [temperature_sensor CB1]
# sensor_type: temperature_host
# min_temp: 0
# max_temp: 100

#####################################################################
# 	X/Y Stepper Settings
#####################################################################

## X Stepper on Motor1 (B Motor)
[stepper_x]
step_pin: PE2
dir_pin: PB4
enable_pin: !PC11
microsteps: 16
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: ^EBBCan: PB6
position_min: 0
##--------------------------------------------------------------------

##	Uncomment below for 250mm build
#position_endstop: 250
#position_max: 250

##	Uncomment for 300mm build
#position_endstop: 300
#position_max: 300

##	Uncomment for 350mm build
position_endstop: 350
position_max: 350

##--------------------------------------------------------------------
homing_speed: 25   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PC10
interpolate: True
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

## Y Stepper on Motor2 (A Motor)
[stepper_y]
step_pin: PF12
dir_pin: PF11
enable_pin: !PB3
microsteps: 16
rotation_distance: 40
full_steps_per_rotation:200  #set to 400 for 0.9 degree stepper
endstop_pin: ^PF3
position_min: 0
##--------------------------------------------------------------------

##	Uncomment for 250mm build
#position_endstop: 250
#position_max: 250

##	Uncomment for 300mm build
#position_endstop: 300
#position_max: 300

##	Uncomment for 350mm build
position_endstop: 350
position_max: 350

##--------------------------------------------------------------------
homing_speed: 25  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PF13
interpolate: True
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
# 	Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left on MOTOR4
[stepper_z]
step_pin: PD3
dir_pin: !PD2
enable_pin: !PD5
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4    
microsteps: 32
endstop_pin: probe:z_virtual_endstop
# endstop_pin: tmc2209_stepper_z:virtual_endstop
##  Z-position of nozzle (in mm) to z-endstop trigger point relative to print surface (Z0)
##  (+) value = endstop above Z0, (-) value = endstop below
##  Increasing position_endstop brings nozzle closer to the bed
##  After you run Z_ENDSTOP_CALIBRATE, position_endstop will be stored at the very end of your config
#position_endstop: -0.5
## All builds use same Max Z
position_max: 250
position_min: -2.5
homing_speed: 8.0 # Leadscrews are slower than 2.4, 10 is a recommended max.
second_homing_speed: 3
homing_retract_dist: 3

[tmc2209 stepper_z]
uart_pin: PD4
interpolate: true
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z1 Stepper - Rear on Motor5
[stepper_z1]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PD1
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4
microsteps: 32
# endstop_pin: tmc2209_stepper_z1:virtual_endstop

[tmc2209 stepper_z1]
uart_pin: PD0
interpolate: true
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##	Z2 Stepper - Front Right on Motor6
[stepper_z2]
step_pin: PA10
dir_pin: !PA14
enable_pin: !PA15
# Rotation Distance for TR8x8 = 8, TR8x4 = 4, TR8x2 = 2
rotation_distance: 4  
microsteps: 32
# endstop_pin: tmc2209_stepper_z2:virtual_endstop

[tmc2209 stepper_z2]
uart_pin: PF8
interpolate: true
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0



#####################################################################
# 	Bed Heater
#####################################################################

[heater_bed]
##	SSR Pin - HE1
heater_pin: PB5 
## Check what thermistor type you have. See https://www.klipper3d.org/Config_Reference.html#common-thermistors for common thermistor types.
## Use "Generic 3950" for Keenovo heaters
sensor_type: Generic 3950
sensor_pin: PA0
##  Adjust max_power so it doesn't exceed the SSR rating. The Omron G3NA-210B-DC5 SSR is rated at 4 amps without a heatsink.
##  The formula is "4 / (Wattage_of_bed_heater / Mains_voltage) = max_power"
##  If max_power is greater than 1.0, use 1.0
max_power: 1
min_temp: 0
max_temp: 125
# control: pid
# pid_kp: 58.437
# pid_ki: 2.347
# pid_kd: 363.769

    
[input_shaper]
#shaper_freq_x: 56.8
#shaper_type_x: mzv
#shaper_freq_y: 36.4
#shaper_type_y: mzv



#####################################################################
# 	LED Control
#####################################################################

[output_pin caselight]
# Chamber Lighting - HE2 Connector (Optional)
pin: PE3
pwm:true
shutdown_value: 0
value: 0.0
cycle_time: 0.01

#####################################################################
# 	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

# [safe_z_home]
# ##	XY Location of the Z Endstop Switch
# ##	Update -10,-10 to the XY coordinates of your endstop pin 
# ##	(such as 157,305) after going through Z Endstop Pin
# ##	Location Definition step.
# home_xy_position:170,170
# speed:100
# z_hop:10

[z_tilt]
##  Use Z_TILT_ADJUST to level the bed .
##  z_positions: Location of toolhead

##--------------------------------------------------------------------
## Uncomment below for 250mm build
#z_positions:
#    -50, 18
#    125, 298
#    300, 18
#points:
#    30, 5
#    125, 195
#    220, 5

## Uncomment below for 300mm build
#z_positions:
#   -50, 18
#   150, 348
#   350, 18
#points:
#   30, 5
#   150, 245
#   270, 5

## Uncomment below for 350mm build
z_positions:
   -50, 18
   175, 398
   400, 18
points:
   30, 5
   175, 295
   320, 5
##--------------------------------------------------------------------

speed: 500
horizontal_move_z: 10
retries: 3
retry_tolerance: 0.0075



#--------------------------------------------------------------------

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3249770.474,0.090000:3248475.082,0.130000:3247171.538,
#*# 	0.170000:3245905.468,0.210000:3244637.877,0.250000:3243327.954,
#*# 	0.290000:3242081.229,0.330000:3240807.919,0.370000:3239566.841,
#*# 	0.410000:3238306.290,0.450000:3237077.197,0.490000:3235842.154,
#*# 	0.530000:3234606.279,0.570000:3233380.235,0.610000:3232183.747,
#*# 	0.650000:3230997.112,0.690000:3229788.133,0.730000:3228614.066,
#*# 	0.770000:3227448.328,0.810000:3226301.603,0.850000:3225174.066,
#*# 	0.890000:3224057.524,0.930000:3222944.809,0.970000:3221863.697,
#*# 	1.010000:3220772.255,1.050000:3219707.480,1.090000:3218684.801,
#*# 	1.130000:3217629.909,1.170000:3216617.965,1.210000:3215658.324,
#*# 	1.250000:3214661.548,1.290000:3213701.386,1.330000:3212754.226,
#*# 	1.370000:3211817.861,1.410000:3210922.044,1.450000:3209989.414,
#*# 	1.490000:3209129.416,1.530000:3208245.065,1.570000:3207413.446,
#*# 	1.610000:3206538.574,1.650000:3205742.158,1.690000:3204933.613,
#*# 	1.730000:3204140.616,1.770000:3203372.415,1.810000:3202604.023,
#*# 	1.850000:3201870.214,1.890000:3201091.080,1.930000:3200396.930,
#*# 	1.970000:3199654.188,2.010000:3198940.415,2.050000:3198274.173,
#*# 	2.090000:3197591.931,2.130000:3196943.915,2.170000:3196294.816,
#*# 	2.210000:3195655.823,2.250000:3195037.395,2.290000:3194438.275,
#*# 	2.330000:3193837.323,2.370000:3193260.518,2.410000:3192667.840,
#*# 	2.450000:3192109.583,2.490000:3191549.782,2.530000:3191022.267,
#*# 	2.570000:3190480.202,2.610000:3189967.237,2.650000:3189432.855,
#*# 	2.690000:3188932.005,2.730000:3188453.957,2.770000:3187947.786,
#*# 	2.810000:3187473.809,2.850000:3187009.553,2.890000:3186531.116,
#*# 	2.930000:3186074.432,2.970000:3185650.241,3.010000:3185213.009,
#*# 	3.050000:3184779.369,3.090000:3184366.995,3.130000:3183932.911,
#*# 	3.170000:3183571.333,3.210000:3183150.684,3.250000:3182776.293,
#*# 	3.290000:3182358.132,3.330000:3181992.144,3.370000:3181631.951,
#*# 	3.410000:3181235.596,3.450000:3180892.780,3.490000:3180543.605,
#*# 	3.530000:3180193.134,3.570000:3179854.010,3.610000:3179529.369,
#*# 	3.650000:3179209.905,3.690000:3178866.401,3.730000:3178569.785,
#*# 	3.770000:3178241.924,3.810000:3177933.362,3.850000:3177657.744,
#*# 	3.890000:3177350.229,3.930000:3177072.547,3.970000:3176786.266,
#*# 	4.010000:3176465.233,4.050000:3176233.826
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 59.131209
#*# drift_calibration =
#*# 	3262779.799903, -670.272238, 3.981907
#*# 	3240806.956053, -487.115465, 3.049585
#*# 	3222374.976356, -334.036216, 2.213580
#*# 	3207820.805699, -215.365028, 1.522480
#*# 	3196555.701191, -128.263696, 1.002376
#*# 	3187768.571052, -62.065974, 0.599693
#*# 	3180837.498368, -10.442389, 0.279793
#*# 	3175334.153006, 29.396578, 0.031468
#*# 	3170959.765852, 60.346665, -0.166389
#*# drift_calibration_min_temp = 38.25694266456327
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.040130, 0.041083, 0.005852, -0.004573, -0.003710, 0.000402, 0.008867, 0.008411, 0.020793, 0.041729, 0.065115, 0.083065, 0.080641
#*# 	0.048926, 0.051644, 0.018492, 0.009239, 0.009047, 0.010911, 0.015756, 0.015785, 0.029217, 0.054902, 0.072339, 0.097359, 0.096663
#*# 	0.066068, 0.069102, 0.031349, 0.022457, 0.025816, 0.025815, 0.032485, 0.032485, 0.044967, 0.070383, 0.086725, 0.112431, 0.112229
#*# 	0.065087, 0.069163, 0.037996, 0.026518, 0.033131, 0.041397, 0.045596, 0.044811, 0.056262, 0.082811, 0.097497, 0.125539, 0.123239
#*# 	0.044436, 0.043827, 0.022115, -0.000049, 0.006799, 0.019654, 0.019029, 0.028074, 0.036680, 0.059461, 0.079414, 0.107852, 0.110062
#*# 	0.024130, 0.030817, 0.000557, -0.002153, 0.006888, 0.010590, 0.011814, 0.015843, 0.035244, 0.053181, 0.078891, 0.110624, 0.108017
#*# 	0.025140, 0.027492, 0.001660, -0.000281, 0.004640, 0.011635, 0.022515, 0.029228, 0.039235, 0.059262, 0.088524, 0.117077, 0.118802
#*# 	0.009052, 0.015770, -0.007062, -0.003056, 0.000301, 0.010845, 0.030592, 0.037505, 0.056407, 0.078184, 0.106942, 0.134716, 0.136323
#*# 	0.015301, 0.011359, -0.010676, -0.010149, -0.002920, 0.007416, 0.022474, 0.049812, 0.058604, 0.085895, 0.110143, 0.144784, 0.156528
#*# 	0.006405, 0.007455, -0.014124, -0.007998, 0.004875, 0.016889, 0.037613, 0.046346, 0.074574, 0.102199, 0.135911, 0.161165, 0.175039
#*# 	-0.000573, -0.000803, -0.032372, -0.014784, 0.001670, 0.015558, 0.033110, 0.042376, 0.077175, 0.104803, 0.138796, 0.173301, 0.182787
#*# 	-0.017728, -0.012143, -0.029278, -0.024025, -0.003353, 0.009766, 0.029075, 0.043356, 0.070061, 0.100510, 0.133288, 0.173794, 0.194131
#*# 	-0.016656, -0.014689, -0.030878, -0.017051, -0.004662, 0.021087, 0.035584, 0.061615, 0.086133, 0.116813, 0.147589, 0.197224, 0.214948
#*# x_count = 13
#*# y_count = 13
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 334.92
#*# min_y = 30.0
#*# max_y = 319.92
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.659
#*# pid_ki = 1.680
#*# pid_kd = 63.527
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 52.292
#*# pid_ki = 1.905
#*# pid_kd = 358.856
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 66.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 45.6
#*#
#*# [skew_correction Califlower]
#*# xy_skew = 0.003419502289188168
#*# xz_skew = 0.0
#*# yz_skew = 0.0
